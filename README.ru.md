[English version](./README.en.md)


# CDR Archiver

## Описание
**CDR Archiver** — Скрипт для автоматического архивирования большого количества файлов CDR (Call Detail Records). Скрипт группирует файлы по месяцам и упаковыкт в архивы. После успешного архивирования исходные файлы удаляются.

**Это личный проект, созданный для решения конкретной задачи.** Если у вас есть идеи по улучшению, вы можете создать Issue или отправить Pull Request. Все предложения приветствуются!

## Что умеет скрипт?
1. **Группирует файлы по месяцам**:
   - Скрипт анализирует имена файлов (например, `cdr_20051001_123456_ROOT.csv`) и определяет, к какому месяцу они относятся.

2. **Создает архивы**:
   - Файлы, относящиеся к одному месяцу, упаковываются в архив с именем в формате `имя_папки_ГОД_МЕСЯЦ.tar.gz`. Например, если папка с файлами называется `call_logs`, то архив будет называться `call_logs_2005_10.tar.gz`.

3. **Удаляет исходные файлы**:
   - После успешного архивирования исходные файлы удаляются, чтобы не занимать лишнее место.

4. **Логирует действия**:
   - Логирование ведется в файл `archive_log.txt`, который создается в папке с архивами.

5. **Проверяет свободное место**:
   - Перед архивированием скрипт проверяет, достаточно ли места на диске.


## Системные требования
- **Операционная система**: Linux.
- **Утилиты**: `bash`, `tar`, `find`, `awk`, `du`, `df`.

## Как установить?
1. Склонируйте репозиторий:
```bash
git clone https://github.com/SkyrocketStan/cdr-archiver.git
cd cdr-archiver
```

2. Сделайте скрипт исполняемым:
```bash
chmod +x cdr_archiver.sh
```

## Как использовать?

### 1. С использованием параметров
```bash
./cdr_archiver.sh --source-dir /path/to/source --archive-dir /path/to/archives --pattern "cdr_*_*.csv"
```

### 2. Без использования параметров
```bash
./cdr_archiver.sh /path/to/source /path/to/archives "cdr_*_*.csv"
```

### 3. Справка
```bash
./cdr_archiver.sh --help
```

## Параметры
| Параметр          | Описание                                                                 |
|-------------------|-------------------------------------------------------------------------|
| `--source-dir`    | Папка, где лежат исходные файлы CDR.                                    |
| `--archive-dir`   | Папка, куда будут сохраняться архивы.                                   |
| `--pattern`       | Шаблон для поиска файлов (по умолчанию: `cdr_*_*.csv`).                |
| `--help`          | Показывает справку по использованию скрипта.                            |


## Логирование
Скрипт создает файл `archive_log.txt` в папке с архивами. Пример лога:
```
2005-10-25 12:34:56 - Успешно: создан архив call_logs_2005_10.tar.gz с 150 файлами.
2005-10-25 12:34:57 - Ошибка: не удалось создать архив call_logs_2005_09.tar.gz.
2005-10-25 12:35:00 - Скрипт завершен.
```

## Как это работает?
- **Групповое архивирование**: Файлы группируются по месяцам и архивируются одной командой.
- **Параллельная обработка**: Если файлов много, можно архивировать данные для разных месяцев одновременно.
- **Проверка свободного места**: Перед архивированием скрипт проверяет, достаточно ли места на диске.


---
